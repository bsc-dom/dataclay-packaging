version: 2.6.dev.build{build}
branches:
  only:
    - develop
build_cloud: Docker
image: Linux
skip_tags: true
skip_branch_with_pr: true
environment:
  DOCKER_USERNAME:
    secure: d9s0OSEPlE156nPrhrsNnA==
  DOCKER_PASSWORD:
    secure: TO42yeTsoNEkuoRQ9ES7MQ==
  matrix:
# LOGICMODULE ALPINE ------------------------------------------------------------------------
    - job_name: Deploy logicmodule alpine jdk11
      job_group: logicmodule
      dataclay_image: logicmodule
      image_type: alpine
      execution_env: jdk11
      docker_image: bscdataclay/continuous-integration:packaging
# DSJAVA ALPINE ------------------------------------------------------------------------
    - job_name: Deploy dsjava alpine jdk11
      job_group: dsjava
      job_depends_on: logicmodule
      dataclay_image: dsjava
      image_type: alpine
      execution_env: jdk11
      docker_image: bscdataclay/continuous-integration:packaging
# DSPYTHON ALPINE ------------------------------------------------------------------------
    - job_name: Deploy dspython alpine py3.6
      job_group: dspython
      job_depends_on: dsjava
      dataclay_image: dspython
      image_type: alpine
      execution_env: py3.6
      docker_image: bscdataclay/continuous-integration:packaging

    - job_name: Deploy dspython alpine py3.7
      job_group: dspython
      job_depends_on: dsjava
      dataclay_image: dspython
      image_type: alpine
      execution_env: py3.7
      docker_image: bscdataclay/continuous-integration:packaging

    - job_name: Deploy dspython alpine py3.8
      job_group: dspython
      job_depends_on: dsjava
      dataclay_image: dspython
      image_type: alpine
      execution_env: py3.8
      docker_image: bscdataclay/continuous-integration:packaging
# CLIENT ALPINE ------------------------------------------------------------------------
    - job_name: Deploy client alpine
      job_group: client
      job_depends_on: dspython
      dataclay_image: client
      image_type: alpine
      docker_image: bscdataclay/continuous-integration:packaging
# the first failed job cancels other jobs and fails entire build
matrix:
  fast_finish: true
for:

  -
    matrix:
      only:
        - job_group: logicmodule
    build_script:
      - /scripts/init.sh
      - ./docker/$dataclay_image/deploy.sh -y --dev --plain --$image_type --ee $execution_env

  -
    matrix:
      only:
        - job_group: dsjava
    build_script:
      - /scripts/init.sh
      - ./docker/$dataclay_image/deploy.sh -y --dev --plain --$image_type --ee $execution_env

  -
    matrix:
      only:
        - job_group: dspython
    build_script:
      - /scripts/init.sh
      - ./docker/$dataclay_image/deploy.sh -y --dev --plain --$image_type --ee $execution_env

  -
    matrix:
      only:
        - job_group: client
    build_script:
      - /scripts/init.sh
      - ./docker/$dataclay_image/deploy.sh -y --dev --plain --$image_type